#!/usr/bin/env python
import ghm
import ghm.options as options
import github


opts = options.parse()
repos = ghm.filter_repos(
    github.Github(opts.token).get_user().get_repos(),
    owner_filter=opts.owner_filter,
    repo_filter=opts.repo_filter,
    ignore_forks=opts.ignore_forks
)
git_credentials = ghm.git_credentials_callback(token=opts.token)
for repo in repos:
    path = ghm.clone_path(opts.path, repo)
    cloned = ghm.clone_repo(
        repo,
        path,
        git_callbacks=git_credentials,
        dry_run=opts.dry_run
    )
    if not cloned:
        ghm.fetch_repo(
            path,
            git_callbacks=git_credentials,
            dry_run=opts.dry_run
        )
